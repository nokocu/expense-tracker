<div class="statistics-container">
  <div class="stats-header">
    <h2>Monthly Statistics</h2>
    <p class="stats-subtitle">{{ getCurrentMonthYear() }}</p>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
  } @else {
    <!-- Overview Cards -->
    <div class="overview-cards">
      <mat-card class="stat-card total-expenses">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>account_balance_wallet</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Total Spent</h3>
            <div class="stat-value">
              <span 
                class="counter-value" 
                [attr.data-value]="monthlyStats().totalExpenses"
                data-currency>
                {{ currencyService.formatAmount(monthlyStats().totalExpenses) }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card average-daily">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>today</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Daily Average</h3>
            <div class="stat-value">
              <span 
                class="counter-value" 
                [attr.data-value]="monthlyStats().averageDaily"
                data-currency>
                {{ currencyService.formatAmount(monthlyStats().averageDaily) }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card categories-count">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>category</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Categories Used</h3>
            <div class="stat-value">
              <span 
                class="counter-value" 
                [attr.data-value]="monthlyStats().categoriesCount">
                {{ monthlyStats().categoriesCount }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      @if (monthlyStats().topCategory) {
        <mat-card class="stat-card top-category">
          <mat-card-content>
            <div class="stat-icon" [style.background-color]="monthlyStats().topCategory!.categoryColor">
              <mat-icon>star</mat-icon>
            </div>
            <div class="stat-content">
              <h3>Top Category</h3>
              <div class="stat-value">{{ monthlyStats().topCategory!.categoryName }}</div>
              <div class="stat-subtext">
                {{ currencyService.formatAmount(monthlyStats().topCategory!.totalAmount) }}
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>

    <mat-divider></mat-divider>

    <!-- Category Breakdown -->
    @if (categoryStats().length > 0) {
      <mat-card class="category-breakdown">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>pie_chart</mat-icon>
            Category Breakdown
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @for (category of categoryStats(); track category.categoryId) {
            <div class="category-item">
              <div class="category-info">
                <mat-chip 
                  [style.background-color]="category.categoryColor"
                  [style.color]="'white'">
                  {{ category.categoryName }}
                </mat-chip>
                <span class="category-transactions">{{ category.transactionCount }} transactions</span>
              </div>
              
              <div class="category-amount">
                {{ currencyService.formatAmount(category.totalAmount) }}
                <span class="percentage">({{ category.percentage.toFixed(1) }}%)</span>
              </div>
              
              <div class="progress-container">
                <mat-progress-bar 
                  class="category-progress"
                  [value]="category.percentage"
                  [attr.data-width]="category.percentage"
                  [color]="'primary'">
                </mat-progress-bar>
              </div>
            </div>
          }
        </mat-card-content>
      </mat-card>
    } @else {
      <mat-card class="no-data">
        <mat-card-content>
          <div class="no-data-content">
            <mat-icon>analytics</mat-icon>
            <h3>No Expenses Yet</h3>
            <p>Start adding expenses to see your statistics!</p>
          </div>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
