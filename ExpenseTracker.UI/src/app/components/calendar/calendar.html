<mat-card class="calendar-container">
  <mat-toolbar class="calendar-header" color="primary">
    <button mat-icon-button (click)="previousMonth()" class="nav-btn">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <span class="spacer"></span>
    <h2 class="month-title">{{ getMonthName() }}</h2>
    <span class="spacer"></span>
    <button mat-icon-button (click)="nextMonth()" class="nav-btn">
      <mat-icon>chevron_right</mat-icon>
    </button>
  </mat-toolbar>

  <div class="calendar-grid">
    <div class="weekday-header">Mon</div>
    <div class="weekday-header">Tue</div>
    <div class="weekday-header">Wed</div>
    <div class="weekday-header">Thu</div>
    <div class="weekday-header">Fri</div>
    <div class="weekday-header">Sat</div>
    <div class="weekday-header">Sun</div>

    @for (day of calendarDays(); track day.date) {
      <mat-card 
        class="calendar-day"
        [class.selected]="selectedDate() && day.date.toDateString() === selectedDate()!.toDateString()"
        [class.today]="isToday(day.date)"
        [class.other-month]="day.isOtherMonth"
        (click)="selectDay(day)"
        [matBadge]="day.totalAmount > 0 ? currencyService.formatAmount(day.totalAmount) : ''"
        [matBadgeHidden]="day.totalAmount === 0"
        matBadgeColor="accent"
        matBadgeSize="small">
        
        <div class="day-number">{{ day.date.getDate() }}</div>
        
        @if (day.totalAmount > 0) {
          <div class="expense-bars">
            @for (bar of getCategoryBars(day); track bar.color) {
              <div 
                class="category-bar"
                [style.background-color]="bar.color"
                [style.width.%]="bar.width">
              </div>
            }
          </div>
        }
      </mat-card>
    }
  </div>

  @if (selectedDate()) {
    <mat-divider></mat-divider>
    <mat-card-content class="day-details">
      <h3>Expenses for {{ selectedDate()!.toLocaleDateString() }}</h3>
      @for (day of calendarDays(); track day.date) {
        @if (day.date.toDateString() === selectedDate()!.toDateString()) {
          @for (expense of day.expenses; track expense.id) {
            <mat-chip-row class="expense-item">
              <mat-icon 
                matChipAvatar 
                [style.background-color]="expense.categoryColor"
                class="expense-category-icon">
                category
              </mat-icon>
              <span class="expense-description">{{ expense.description }}</span>
              <span class="expense-amount">{{ currencyService.formatAmount(expense.amount) }}</span>
            </mat-chip-row>
          }
        }
      }
    </mat-card-content>
  }
</mat-card>
