<div class="calendar-container">
  <div class="calendar-header">
    <button (click)="previousMonth()" class="nav-btn">&lt;</button>
    <h2>{{ getMonthName() }}</h2>
    <button (click)="nextMonth()" class="nav-btn">&gt;</button>
  </div>

  <div class="calendar-grid">
    <div class="weekday-header">Mon</div>
    <div class="weekday-header">Tue</div>
    <div class="weekday-header">Wed</div>
    <div class="weekday-header">Thu</div>
    <div class="weekday-header">Fri</div>
    <div class="weekday-header">Sat</div>
    <div class="weekday-header">Sun</div>

    @for (day of calendarDays(); track day.date) {
      <div 
        class="calendar-day"
        [class.selected]="selectedDate() && day.date.toDateString() === selectedDate()!.toDateString()"
        [class.today]="isToday(day.date)"
        [class.other-month]="day.isOtherMonth"
        (click)="selectDay(day)">
        
        <div class="day-number">{{ day.date.getDate() }}</div>
        
        @if (day.totalAmount > 0) {
          <div class="expense-bars">
            @for (bar of getCategoryBars(day); track bar.color) {
              <div 
                class="category-bar"
                [style.background-color]="bar.color"
                [style.width.%]="bar.width">
              </div>
            }
          </div>
          <div class="total-amount">{{ currencyService.formatAmount(day.totalAmount) }}</div>
        }
      </div>
    }
  </div>

  @if (selectedDate()) {
    <div class="day-details">
      <h3>Expenses for {{ selectedDate()!.toLocaleDateString() }}</h3>
      @for (day of calendarDays(); track day.date) {
        @if (day.date.toDateString() === selectedDate()!.toDateString()) {
          @for (expense of day.expenses; track expense.id) {
            <div class="expense-item">
              <span class="expense-category" [style.background-color]="expense.categoryColor">
                {{ expense.categoryName }}
              </span>
              <span class="expense-description">{{ expense.description }}</span>
              <span class="expense-amount">{{ currencyService.formatAmount(expense.amount) }}</span>
            </div>
          }
        }
      }
    </div>
  }
</div>
